import _createForOfIteratorHelper from "@babel/runtime/helpers/createForOfIteratorHelper";
import _toConsumableArray from "@babel/runtime/helpers/toConsumableArray";
import _objectSpread from "@babel/runtime/helpers/objectSpread2";
import _asyncToGenerator from "@babel/runtime/helpers/asyncToGenerator";
import _objectWithoutProperties from "@babel/runtime/helpers/objectWithoutProperties";
import _regeneratorRuntime from "@babel/runtime/regenerator";
import React, { useEffect, useImperativeHandle } from 'react';
import ReactMarkdown from 'react-markdown';
import gfm from 'remark-gfm';
import Prism from 'prismjs';
import 'prismjs/components/prism-markup';
import { loadLang } from './langs';
import "./styles/markdown.css";
import "./styles/markdowncolor.css";
export default /*#__PURE__*/React.forwardRef(function (props, ref) {
  var _ref = props || {},
      className = _ref.className,
      source = _ref.source,
      style = _ref.style,
      onScroll = _ref.onScroll,
      onMouseOver = _ref.onMouseOver,
      other = _objectWithoutProperties(_ref, ["className", "source", "style", "onScroll", "onMouseOver"]);

  var mdp = /*#__PURE__*/React.createRef();
  var loadedLang = React.useRef(['markup']);
  useEffect(function () {
    highlight(); // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [source]);

  function highlight() {
    return _highlight.apply(this, arguments);
  }

  function _highlight() {
    _highlight = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {
      var codes, _iterator, _step, val, tag, lang;

      return _regeneratorRuntime.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              if (mdp.current) {
                _context.next = 2;
                break;
              }

              return _context.abrupt("return");

            case 2:
              codes = mdp.current.getElementsByTagName('code');
              _iterator = _createForOfIteratorHelper(codes);
              _context.prev = 4;

              _iterator.s();

            case 6:
              if ((_step = _iterator.n()).done) {
                _context.next = 24;
                break;
              }

              val = _step.value;
              tag = val.parentNode;

              if (!(tag && tag.tagName === 'PRE' && /^language-/.test(val.className.trim()))) {
                _context.next = 22;
                break;
              }

              lang = val.className.trim().replace(/^language-/, '');
              _context.prev = 11;

              if (loadedLang.current.includes(lang)) {
                _context.next = 16;
                break;
              }

              loadedLang.current.push(lang);
              _context.next = 16;
              return loadLang(lang);

            case 16:
              _context.next = 18;
              return Prism.highlightElement(val);

            case 18:
              _context.next = 22;
              break;

            case 20:
              _context.prev = 20;
              _context.t0 = _context["catch"](11);

            case 22:
              _context.next = 6;
              break;

            case 24:
              _context.next = 29;
              break;

            case 26:
              _context.prev = 26;
              _context.t1 = _context["catch"](4);

              _iterator.e(_context.t1);

            case 29:
              _context.prev = 29;

              _iterator.f();

              return _context.finish(29);

            case 32:
            case "end":
              return _context.stop();
          }
        }
      }, _callee, null, [[4, 26, 29, 32], [11, 20]]);
    }));
    return _highlight.apply(this, arguments);
  }

  useImperativeHandle(ref, function () {
    return _objectSpread(_objectSpread({}, props), {}, {
      lang: loadedLang.current,
      mdp: mdp
    });
  }, [mdp, props]);
  var cls = "wmde-markdown wmde-markdown-color ".concat(className || '');

  var reactMarkdownProps = _objectSpread(_objectSpread({
    allowDangerousHtml: true,
    allowNode: function allowNode(node, index, parent) {
      if (node.type === 'html' && reactMarkdownProps.allowDangerousHtml) {
        // filter style
        node.value = node.value.replace(/<((style|script|link|input|form)|\/(style|script|link|input|form))(\s?[^>]*>)/gi, function (a) {
          return a.replace(/[<>]/g, function (e) {
            return {
              '<': '&lt;',
              '>': '&gt;'
            }[e];
          });
        });
      }

      return true;
    }
  }, other), {}, {
    plugins: [gfm].concat(_toConsumableArray(other.plugins || [])),
    source: source || ''
  });

  return /*#__PURE__*/React.createElement("div", {
    ref: mdp,
    onScroll: onScroll,
    onMouseOver: onMouseOver,
    className: cls,
    style: style
  }, /*#__PURE__*/React.createElement(ReactMarkdown, reactMarkdownProps));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9pbmRleC50c3giXSwibmFtZXMiOlsiUmVhY3QiLCJ1c2VFZmZlY3QiLCJ1c2VJbXBlcmF0aXZlSGFuZGxlIiwiUmVhY3RNYXJrZG93biIsImdmbSIsIlByaXNtIiwibG9hZExhbmciLCJmb3J3YXJkUmVmIiwicHJvcHMiLCJyZWYiLCJjbGFzc05hbWUiLCJzb3VyY2UiLCJzdHlsZSIsIm9uU2Nyb2xsIiwib25Nb3VzZU92ZXIiLCJvdGhlciIsIm1kcCIsImNyZWF0ZVJlZiIsImxvYWRlZExhbmciLCJ1c2VSZWYiLCJoaWdobGlnaHQiLCJjdXJyZW50IiwiY29kZXMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInZhbCIsInRhZyIsInBhcmVudE5vZGUiLCJ0YWdOYW1lIiwidGVzdCIsInRyaW0iLCJsYW5nIiwicmVwbGFjZSIsImluY2x1ZGVzIiwicHVzaCIsImhpZ2hsaWdodEVsZW1lbnQiLCJjbHMiLCJyZWFjdE1hcmtkb3duUHJvcHMiLCJhbGxvd0Rhbmdlcm91c0h0bWwiLCJhbGxvd05vZGUiLCJub2RlIiwiaW5kZXgiLCJwYXJlbnQiLCJ0eXBlIiwidmFsdWUiLCJhIiwiZSIsInBsdWdpbnMiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLE9BQU9BLEtBQVAsSUFBZ0JDLFNBQWhCLEVBQTJCQyxtQkFBM0IsUUFBc0QsT0FBdEQ7QUFDQSxPQUFPQyxhQUFQLE1BQWtELGdCQUFsRDtBQUNBLE9BQU9DLEdBQVAsTUFBZ0IsWUFBaEI7QUFDQSxPQUFPQyxLQUFQLE1BQWtCLFNBQWxCO0FBQ0EsT0FBTyxpQ0FBUDtBQUNBLFNBQVNDLFFBQVQsUUFBeUIsU0FBekI7QUFDQTtBQUNBO0FBZUEsNEJBQWVOLEtBQUssQ0FBQ08sVUFBTixDQUEyRCxVQUFDQyxLQUFELEVBQVFDLEdBQVIsRUFBZ0I7QUFBQSxhQUNqQkQsS0FBSyxJQUFJLEVBRFE7QUFBQSxNQUNoRkUsU0FEZ0YsUUFDaEZBLFNBRGdGO0FBQUEsTUFDckVDLE1BRHFFLFFBQ3JFQSxN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T0FBRixDQUFVLE9BQVYsRUFBbUIsVUFBQ2MsQ0FBRDtBQUFBLG1CQUFpQjtBQUFFLG1CQUFLLE1BQVA7QUFBZSxtQkFBSztBQUFwQixhQUFELENBQTREQSxDQUE1RCxDQUFoQjtBQUFBLFdBQW5CLENBQVA7QUFDRCxTQUZZLENBQWI7QUFHRDs7QUFDRCxhQUFPLElBQVA7QUFDRDtBQVZxQixLQVduQjlCLEtBWG1CO0FBWXRCK0IsSUFBQUEsT0FBTyxHQUFHMUMsR0FBSCw0QkFBYVcsS0FBSyxDQUFDK0IsT0FBTixJQUFpQixFQUE5QixFQVplO0FBYXRCbkMsSUFBQUEsTUFBTSxFQUFFQSxNQUFNLElBQUk7QUFiSSxJQUF4Qjs7QUFlQSxzQkFDRTtBQUFLLElBQUEsR0FBRyxFQUFFSyxHQUFWO0FBQWUsSUFBQSxRQUFRLEVBQUVILFFBQXpCO0FBQW1DLElBQUEsV0FBVyxFQUFFQyxXQUFoRDtBQUE2RCxJQUFBLFNBQVMsRUFBRXFCLEdBQXhFO0FBQTZFLElBQUEsS0FBSyxFQUFFdkI7QUFBcEYsa0JBQ0Usb0JBQUMsYUFBRCxFQUFtQndCLGtCQUFuQixDQURGLENBREY7QUFLRCxDQWxEYyxDQUFmIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IHVzZUVmZmVjdCwgdXNlSW1wZXJhdGl2ZUhhbmRsZSB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBSZWFjdE1hcmtkb3duLCB7IFJlYWN0TWFya2Rvd25Qcm9wcyB9IGZyb20gJ3JlYWN0LW1hcmtkb3duJztcbmltcG9ydCBnZm0gZnJvbSAncmVtYXJrLWdmbSc7XG5pbXBvcnQgUHJpc20gZnJvbSAncHJpc21qcyc7XG5pbXBvcnQgJ3ByaXNtanMvY29tcG9uZW50cy9wcmlzbS1tYXJrdXAnO1xuaW1wb3J0IHsgbG9hZExhbmcgfSBmcm9tICcuL2xhbmdzJztcbmltcG9ydCAnLi9zdHlsZXMvbWFya2Rvd24ubGVzcyc7XG5pbXBvcnQgJy4vc3R5bGVzL21hcmtkb3duY29sb3IubGVzcyc7XG5cbmV4cG9ydCB0eXBlIE1hcmtkb3duUHJldmlld1Byb3BzID0ge1xuICBjbGFzc05hbWU/OiBzdHJpbmc7XG4gIHNvdXJjZT86IHN0cmluZztcbiAgc3R5bGU/OiBSZWFjdC5DU1NQcm9wZXJ0aWVzO1xuICBvblNjcm9sbD86IChlOiBSZWFjdC5VSUV2ZW50PEhUTUxEaXZFbGVtZW50PikgPT4gdm9pZDtcbiAgb25Nb3VzZU92ZXI/OiAoZTogUmVhY3QuTW91c2VFdmVudDxIVE1MRGl2RWxlbWVudD4pID0+IHZvaWQ7XG59ICYgUmVhY3RNYXJrZG93blByb3BzO1xuXG5leHBvcnQgdHlwZSBNYXJrZG93blByZXZpZXdSZWYgPSB7XG4gIG1kcDogUmVhY3QuUmVmT2JqZWN0PEhUTUxEaXZFbGVtZW50PjtcbiAgbGFuZzogc3RyaW5nW10sXG59ICYgTWFya2Rvd25QcmV2aWV3UHJvcHM7XG5cbmV4cG9ydCBkZWZhdWx0IFJlYWN0LmZvcndhcmRSZWY8TWFya2Rvd25QcmV2aWV3UmVmLCBNYXJrZG93blByZXZpZXdQcm9wcz4oKHByb3BzLCByZWYpID0+IHtcbiAgY29uc3QgeyBjbGFzc05hbWUsIHNvdXJjZSwgc3R5bGUsIG9uU2Nyb2xsLCBvbk1vdXNlT3ZlciwgLi4ub3RoZXIgIH0gPSBwcm9wcyB8fCB7fTtcbiAgY29uc3QgbWRwID0gUmVhY3QuY3JlYXRlUmVmPEhUTUxEaXZFbGVtZW50PigpO1xuICBjb25zdCBsb2FkZWRMYW5nID0gUmVhY3QudXNlUmVmPHN0cmluZ1tdPihbJ21hcmt1cCddKTtcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBoaWdobGlnaHQoKTtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzXG4gIH0sIFtzb3VyY2VdKTtcblxuICBhc3luYyBmdW5jdGlvbiBoaWdobGlnaHQoKSB7XG4gICAgaWYgKCFtZHAuY3VycmVudCkgcmV0dXJuO1xuICAgIGNvbnN0IGNvZGVzID0gbWRwLmN1cnJlbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2NvZGUnKSBhcyB1bmtub3duIGFzIEhUTUxFbGVtZW50W107XG4gICAgZm9yIChjb25zdCB2YWwgb2YgY29kZXMpIHtcbiAgICAgIGNvbnN0IHRhZyA9IHZhbC5wYXJlbnROb2RlIGFzIEhUTUxFbGVtZW50O1xuICAgICAgaWYgKHRhZyAmJiB0YWcudGFnTmFtZSA9PT0gJ1BSRScgJiYgL15sYW5ndWFnZS0vLnRlc3QodmFsLmNsYXNzTmFtZS50cmltKCkpKSB7XG4gICAgICAgIGNvbnN0IGxhbmcgPSB2YWwuY2xhc3NOYW1lLnRyaW0oKS5yZXBsYWNlKC9ebGFuZ3VhZ2UtLywgJycpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGlmICghbG9hZGVkTGFuZy5jdXJyZW50LmluY2x1ZGVzKGxhbmcgYXMgbmV2ZXIpKSB7XG4gICAgICAgICAgICBsb2FkZWRMYW5nLmN1cnJlbnQucHVzaChsYW5nKTtcbiAgICAgICAgICAgIGF3YWl0IGxvYWRMYW5nKGxhbmcpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBhd2FpdCBQcmlzbS5oaWdobGlnaHRFbGVtZW50KHZhbCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7IH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICB1c2VJbXBlcmF0aXZlSGFuZGxlKHJlZiwgKCkgPT4gKHsgLi4ucHJvcHMsIGxhbmc6IGxvYWRlZExhbmcuY3VycmVudCwgbWRwIH0pLCBbbWRwLCBwcm9wc10pO1xuXG4gIGNvbnN0IGNscyA9IGB3bWRlLW1hcmtkb3duIHdtZGUtbWFya2Rvd24tY29sb3IgJHtjbGFzc05hbWUgfHwgJyd9YDtcbiAgY29uc3QgcmVhY3RNYXJrZG93blByb3BzID0ge1xuICAgIGFsbG93RGFuZ2Vyb3VzSHRtbDogdHJ1ZSxcbiAgICBhbGxvd05vZGU6IChub2RlLCBpbmRleCwgcGFyZW50KSA9PiB7XG4gICAgICBpZiAobm9kZS50eXBlID09PSAnaHRtbCcgJiYgcmVhY3RNYXJrZG93blByb3BzLmFsbG93RGFuZ2Vyb3VzSHRtbCkge1xuICAgICAgICAvLyBmaWx0ZXIgc3R5bGVcbiAgICAgICAgbm9kZS52YWx1ZSA9IChub2RlLnZhbHVlIGFzIHN0cmluZykucmVwbGFjZSgvPCgoc3R5bGV8c2NyaXB0fGxpbmt8aW5wdXR8Zm9ybSl8XFwvKHN0eWxlfHNjcmlwdHxsaW5rfGlucHV0fGZvcm0pKShcXHM/W14+XSo+KS9naSwgKGE6IHN0cmluZykgPT4ge1xuICAgICAgICAgIHJldHVybiBhLnJlcGxhY2UoL1s8Pl0vZywgKGU6IHN0cmluZykgPT4gKCh7ICc8JzogJyZsdDsnLCAnPic6ICcmZ3Q7JyB9IGFzIHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0pW2VdKSlcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuICAgIC4uLm90aGVyLFxuICAgIHBsdWdpbnM6IFtnZm0sICAuLi4ob3RoZXIucGx1Z2lucyB8fCBbXSldLFxuICAgIHNvdXJjZTogc291cmNlIHx8ICcnLFxuICB9IGFzIFJlYWN0TWFya2Rvd25Qcm9wcztcbiAgcmV0dXJuIChcbiAgICA8ZGl2IHJlZj17bWRwfSBvblNjcm9sbD17b25TY3JvbGx9IG9uTW91c2VPdmVyPXtvbk1vdXNlT3Zlcn0gY2xhc3NOYW1lPXtjbHN9IHN0eWxlPXtzdHlsZX0+XG4gICAgICA8UmVhY3RNYXJrZG93biB7Li4ucmVhY3RNYXJrZG93blByb3BzfSAvPlxuICAgIDwvZGl2PlxuICApO1xufSk7XG4iXX0=